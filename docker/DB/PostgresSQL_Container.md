# Описание контейнера db

Ниже приведено подробное описание конфигурации сервиса `db` . Данный сервис служит STAGE базой-приёмником.

---

## Общая информация

- **Версия Docker Compose:**  
  Используется версия `3.11`, что позволяет применять современные возможности Docker Compose.

- **Сеть:**  
  - Определена сеть `my_network` с параметром `external: true`.  
    Сеть уже создана вне данного файла и используется для подключения контейнера к существующей инфраструктуре. Необходима для связи контейнеров Airflow с контейнеров БД STAGE для работы Connection's в Airflow.

---

## Сервис db

Сервис `db` предназначен для запуска контейнера с базой данных PostgreSQL. Его ключевые настройки следующие:

### Сборка и образ

- **build:**  
  - `build: .`  
    Контейнер собирается из Dockerfile, расположенного в текущей директории. Это позволяет кастомизировать образ по необходимости.

- **image:**  
  - `postgres:custom`  
    После сборки образ получает тег `postgres:custom`, что указывает на модифицированную версию официального образа PostgreSQL.

- **container_name:**  
  - `postgresstg`  
    Контейнер будет запущен под именем `postgresstg`, что упрощает его идентификацию и управление.

### Настройка окружения

- **env_file:**  
  - `.env`  
    Файл `.env` содержит переменные окружения, которые используются для настройки контейнера (например, параметры аутентификации и конфигурации PostgreSQL).

### Проброс портов

- **ports:**  
  - `"${POSTGRES_PORT}:5432"`  
    Контейнерный порт `5432` (стандартный порт PostgreSQL) пробрасывается на порт, указанный в переменной `POSTGRES_PORT` из файла `.env`. Это позволяет гибко настраивать порт на стороне хоста.

### Том для хранения данных

- **volumes:**  
  - `pgdata:/var/lib/postgresql/data`  
    Монтируется именованный том `pgdata` для хранения данных PostgreSQL. Все данные, находящиеся в каталоге `/var/lib/postgresql/data` внутри контейнера, сохраняются в томе, что обеспечивает их сохранность между перезапусками контейнера.

### Сетевое подключение

- **networks:**  
  - Контейнер подключается к сети `my_network`, что позволяет ему взаимодействовать с другими сервисами, находящимися в этой сети.

---

## Определение томов

    volumes:
        pgdata:
