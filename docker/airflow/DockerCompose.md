# Подробное описание файла docker-compose.yml

Описание конфигураций контейнеризации Apache Airflow с использованием Docker Compose версии 3.11. Ниже приведено детальное описание каждого раздела и его свойств.

---

## 1. Версия файла

version: '3.11'
Назначение:
Определяет используемую версию синтаксиса Docker Compose. Версия 3.11 подходит для современных функций Docker Compose и совместима с Docker Swarm.

## 2. Определение сетей

Назначение — Задает сеть, в которой будут работать контейнеры.
Параметры:
my_network — Имя сети, используемой для связи между контейнерами.
external: true — Указывает, что данная сеть уже создана вне файла docker-compose.yml и Docker Compose будет использовать существующую сеть. Это удобно для интеграции с другими сервисами, уже работающими в этой сети.


## 3. Определение сервисов
В данном файле описаны три сервиса: postgres, airflow-webserver и airflow-scheduler.

### 3.1. Сервис postgres:

Используется официальный образ PostgreSQL версии 15, что обеспечивает стабильную работу базы данных.
- **container_name — Задает имя контейнера airflow-postgres для удобного обращения и управления.**
- **networks — Контейнер подключается к внешней сети my_network для взаимодействия с другими сервисами.**
- **environment — Определяет переменные окружения для настройки базы данных:**
- **POSTGRES_USER, POSTGRES_PASSWORD, POSTGRES_DB — задают имя пользователя, пароль и имя базы данных соответственно.**
- **volumes — Монтирует том postgres_data для сохранения данных базы, чтобы они сохранялись между перезапусками контейнера.**
- **ports — Пробрасывает порт 5432 из контейнера на хост, позволяя внешним приложениям подключаться к базе данных.**

### 3.2. Сервис airflow-webserver:

- **build — Указывает, что образ будет собираться локально по предоставленному Dockerfile:**
- **context — текущая директория, где находится Dockerfile.**
- **dockerfile — Имя файла Dockerfile, используемого для сборки.**
- **container_name — Задает имя контейнера airflow-webserver для удобного управления.**
- **depends_on — Указывает, что сервис зависит от postgres, что гарантирует запуск базы данных до старта веб-сервера.**
- **networks — Контейнер подключается к сети my_network для связи с другими сервисами.**
- **environment — Перечислены переменные окружения для настройки Airflow:**
    - AIRFLOW__CORE__EXECUTOR — указывает использование LocalExecutor.
    - AIRFLOW__DATABASE__SQL_ALCHEMY_CONN — строка подключения к базе данных Postgres, используя psycopg2.
    - AIRFLOW__CORE__FERNET_KEY, AIRFLOW__CORE__LOAD_EXAMPLES, AIRFLOW__WEBSERVER__SECRET_KEY — настройки безопасности и поведения Airflow.
    - AIRFLOW_UID — идентификатор пользователя для корректного управления правами доступа.
    - **volumes — Монтирует локальные директории и тома для:**
DAG-ов (./dags)
SQL-скриптов (./sql)
Конфигурационных файлов (./config)
Логов (airflow_logs)
Плагинов (airflow_plugins)
- **ports — Пробрасывает порт 8080, обеспечивая доступ к веб-интерфейсу Airflow извне.**
- **command — Определяет команду для запуска контейнера:**
Выполняется обновление базы данных (airflow db upgrade).
Создаются пользователи (Admin и Guest), если они еще не созданы.
Запускается веб-сервер Airflow.
- **env_file — Подключает файл .env для загрузки дополнительных переменных окружения, что упрощает управление конфигурацией.**

### 3.3. Сервис airflow-scheduler:

- **Сборка и настрйока airflow-scheduler аналогична п.3.2 airflow-webserver**

## 4. Определение томов:

Назначение — Объявляет именованные тома для:
- **postgres_data — Хранение данных базы данных Postgres, чтобы они сохранялись между перезапусками контейнера.**
- **airflow_logs — Хранение логов Airflow, что позволяет отслеживать выполнение задач.**
- **airflow_plugins — Хранение плагинов Airflow, которые расширяют функциональность системы.**
